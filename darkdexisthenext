local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer

pcall(function() CoreGui.DarkDexTowerGUI:Destroy() end)

local gui = Instance.new("ScreenGui")
gui.Name = "DarkDexTowerGUI"
gui.Parent = CoreGui
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.ResetOnSpawn = false

-- Splash
local splash = Instance.new("TextLabel")
splash.Size = UDim2.new(1,0,1,0)
splash.BackgroundColor3 = Color3.new(0,0,0)
splash.Text = "MADE BY DARKDEX ^"
splash.TextColor3 = Color3.fromRGB(0,255,0)
splash.TextScaled = true
splash.Font = Enum.Font.GothamBlack
splash.TextStrokeTransparency = 0
splash.ZIndex = 10
splash.Parent = gui
splash.BackgroundTransparency = 1

TweenService:Create(splash, TweenInfo.new(1.2), {BackgroundTransparency=0}):Play()

local main = Instance.new("Frame")
main.Size = UDim2.new(0,400,0,300)
main.Position = UDim2.new(0.5,-200,1,0)
main.BackgroundColor3 = Color3.fromRGB(25,25,25)
main.Visible = false
main.Parent = gui
Instance.new("UICorner", main).CornerRadius = UDim.new(0,10)

task.delay(2, function()
    TweenService:Create(splash, TweenInfo.new(1.2), {BackgroundTransparency=1}):Play()
    main.Visible = true
    TweenService:Create(main, TweenInfo.new(1.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Position = UDim2.new(0.5,-200,0.5,-150)
    }):Play()
    task.wait(1.2)
    splash:Destroy()
end)

local close = Instance.new("TextButton")
close.Size = UDim2.new(0,30,0,30)
close.Position = UDim2.new(1,-35,0,5)
close.Text = "X"
close.Font = Enum.Font.GothamBold
close.TextScaled = true
close.TextColor3 = Color3.fromRGB(255,0,0)
close.BackgroundColor3 = Color3.fromRGB(50,0,0)
close.Parent = main

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,-40,0,40)
title.Position = UDim2.new(0,20,0,5)
title.Text = "DarkDex Tower GUI"
title.Font = Enum.Font.GothamBlack
title.TextScaled = true
title.TextColor3 = Color3.fromRGB(0,255,0)
title.BackgroundTransparency = 1
title.Parent = main

local notify = Instance.new("TextLabel")
notify.Size = UDim2.new(0,220,0,40)
notify.Position = UDim2.new(1,-240,1,-60)
notify.BackgroundColor3 = Color3.fromRGB(30,30,30)
notify.TextColor3 = Color3.fromRGB(255,100,100)
notify.Text = "Doesn't work on mobile"
notify.Font = Enum.Font.Gotham
notify.TextScaled = true
notify.Visible = false
notify.ZIndex = 10
notify.Parent = gui
Instance.new("UICorner", notify).CornerRadius = UDim.new(0,8)

local buttonHolder = Instance.new("Frame")
buttonHolder.Size = UDim2.new(1,-40,1,-60)
buttonHolder.Position = UDim2.new(0,20,0,50)
buttonHolder.BackgroundTransparency = 1
buttonHolder.Parent = main

local function createButton(text,y)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,0,0,40)
    btn.Position = UDim2.new(0,0,0,y)
    btn.Text = text
    btn.Font = Enum.Font.GothamBold
    btn.TextScaled = true
    btn.TextColor3 = Color3.fromRGB(0,255,0)
    btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,8)
    btn.Parent = buttonHolder
    return btn
end

local infLoop = false

local infMoneyBtn = createButton("Start Infinite Money",0)
infMoneyBtn.MouseButton1Click:Connect(function()
    infLoop = not infLoop
    infMoneyBtn.Text = infLoop and "Stop Infinite Money" or "Start Infinite Money"
    if infLoop then
        task.spawn(function()
            while infLoop do
                ReplicatedStorage:WaitForChild("RestartRemotes"):WaitForChild("GiveClaimMoney"):FireServer({player})
                task.wait(0.1)
            end
        end)
    end
end)

local gearBtn = createButton("Get Free Gear",50)
gearBtn.MouseButton1Click:Connect(function()
    ReplicatedStorage:WaitForChild("FreeGear_Remotes"):WaitForChild("FreeGearEvent"):FireServer({player})
end)

local scriptBloxBtn = createButton("ScriptBlox (PC)",100)
scriptBloxBtn.MouseButton1Click:Connect(function()
    if UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled then
        notify.Visible = true
        task.delay(2,function() notify.Visible = false end)
    else
        local url = "https://scriptblox.com/u/darkdex"
        if syn and syn.request then
            syn.request({Url = url, Method = "GET"})
        elseif setclipboard then
            setclipboard(url)
            StarterGui:SetCore("SendNotification",{
                Title = "Copied",
                Text = "Link copied to clipboard",
                Duration = 2
            })
        end
    end
end)

local destroyBtn = createButton("Destroy GUI",150)
destroyBtn.MouseButton1Click:Connect(function()
    gui:Destroy()
end)

local openButton = Instance.new("TextButton")
openButton.Size = UDim2.new(0,60,0,60)
openButton.Position = UDim2.new(0,10,0.5,-30)
openButton.Text = "+"
openButton.Font = Enum.Font.GothamBold
openButton.TextScaled = true
openButton.TextColor3 = Color3.fromRGB(0,255,0)
openButton.BackgroundColor3 = Color3.fromRGB(20,20,20)
Instance.new("UICorner", openButton).CornerRadius = UDim.new(0,10)
openButton.Parent = gui
openButton.Visible = false

local openLabel = Instance.new("TextLabel")
openLabel.Size = UDim2.new(0,100,0,40)
openLabel.Position = UDim2.new(1,5,0.5,-20)
openLabel.BackgroundColor3 = Color3.fromRGB(20,20,20)
openLabel.Text = "OPEN GUI"
openLabel.TextColor3 = Color3.fromRGB(0,255,0)
openLabel.TextScaled = true
openLabel.Font = Enum.Font.GothamBold
openLabel.Visible = false
openLabel.Parent = openButton
Instance.new("UICorner", openLabel).CornerRadius = UDim.new(0,8)

openButton.MouseEnter:Connect(function()
    openLabel.Visible = true
    TweenService:Create(openLabel, TweenInfo.new(0.3), {Position=UDim2.new(1,10,0.5,-20)}):Play()
end)

openButton.MouseLeave:Connect(function()
    TweenService:Create(openLabel, TweenInfo.new(0.3), {Position=UDim2.new(1,5,0.5,-20)}):Play()
    task.delay(0.3, function()
        openLabel.Visible = false
    end)
end)

-- Drag & Drop (PC + Mobil)
local dragging = false
local dragInput = nil
local dragStart = nil
local startPos = nil

local function update(input)
    local delta = input.Position - dragStart
    main.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
end

main.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = main.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

main.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        update(input)
    end
end)

main.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

main.Visible = true
openButton.Visible = false

close.MouseButton1Click:Connect(function()
    main.Visible = false
    openButton.Visible = true
end)

openButton.MouseButton1Click:Connect(function()
    main.Visible = true
    openButton.Visible = false
end)
